name: Keep Server Alive

on:
  # Run every 30 minutes to prevent Render free tier spin-down
  schedule:
    - cron: '*/30 * * * *'

  # Allow manual triggering
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Health Endpoint
        run: |
          echo "ðŸ“ Pinging server to keep it alive..."
          echo "ðŸ“… $(date)"

          response=$(curl -s -o /dev/null -w "%{http_code}" "${{ secrets.RENDER_URL }}/health")

          if [ "$response" -eq 200 ]; then
            echo "âœ… Server is alive! (HTTP $response)"
          else
            echo "âš ï¸ Unexpected response: HTTP $response"
            # Don't fail the workflow - server might be starting up
          fi

      - name: Summary
        if: always()
        run: |
          echo "### ðŸ“ Keep-Alive Ping" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Server pinged at $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "This prevents Render free tier from spinning down after 15 minutes of inactivity." >> $GITHUB_STEP_SUMMARY
