<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Limerick Weekly - AI-Generated Local News</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #fafafa;
            color: #1a1a1a;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: #1a1a1a;
            color: white;
            padding: 2rem;
            text-align: center;
            border-bottom: 4px solid #c41e3a;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 900;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1rem;
            font-style: italic;
            color: #ccc;
        }

        .date {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #999;
            border-top: 1px solid #444;
            padding-top: 1rem;
        }

        /* Main Content */
        .content {
            padding: 3rem 2rem;
        }

        .intro {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid #eee;
        }

        .intro h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #c41e3a;
        }

        .count {
            font-size: 1.1rem;
            color: #666;
        }

        /* Article List */
        .articles-list {
            list-style: none;
        }

        .article-item {
            border-bottom: 1px solid #eee;
            padding: 2rem 0;
        }

        .article-item:last-child {
            border-bottom: none;
        }

        .article-number {
            display: inline-block;
            background: #c41e3a;
            color: white;
            padding: 0.3rem 0.8rem;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .article-title {
            font-size: 1.8rem;
            line-height: 1.3;
            margin-bottom: 0.5rem;
        }

        .article-title a {
            color: #1a1a1a;
            text-decoration: none;
            transition: color 0.3s;
        }

        .article-title a:hover {
            color: #c41e3a;
        }

        .article-summary {
            color: #555;
            font-size: 1.05rem;
            margin: 1rem 0;
            line-height: 1.6;
        }

        .article-meta {
            font-size: 0.9rem;
            color: #999;
            margin-top: 1rem;
        }

        .read-more {
            display: inline-block;
            margin-top: 1rem;
            color: #c41e3a;
            text-decoration: none;
            font-weight: bold;
            font-size: 1rem;
        }

        .read-more:hover {
            text-decoration: underline;
        }

        /* Footer */
        .footer {
            background: #f5f5f5;
            text-align: center;
            padding: 2rem;
            border-top: 2px solid #eee;
            margin-top: 3rem;
        }

        .footer p {
            margin: 0.5rem 0;
            color: #666;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 4rem;
            font-size: 1.2rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>The Limerick Weekly</h1>
            <p>AI-Generated Local News for Limerick</p>
            <div class="date" id="currentDate"></div>
        </header>

        <!-- Main Content -->
        <main class="content">
            <div id="loadingMessage" class="loading">
                üì∞ Loading articles...
            </div>

            <div id="articlesContainer" style="display: none;">
                <div class="intro">
                    <h2>Latest Stories</h2>
                    <p class="count"><span id="articleCount"></span> AI-generated articles with Limerick connections</p>
                </div>
                <ul class="articles-list" id="articlesList"></ul>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p><strong>The Limerick Weekly</strong></p>
            <p>AI-powered news ‚Ä¢ All articles rewritten for local relevance</p>
        </footer>
    </div>

    <script>
        // Set current date
        const dateEl = document.getElementById('currentDate');
        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        dateEl.textContent = today.toLocaleDateString('en-IE', options);

        // Category mapping
        const categoryMap = {
            sport: '‚öΩ Sport',
            politics: 'üèõÔ∏è Politics',
            local: 'üèòÔ∏è Local',
            business: 'üíº Business',
            events: 'üé≠ Events',
            culture: 'üé® Culture'
        };

        // Determine category from article
        function determineCategory(article) {
            const text = (article.headline + ' ' + article.story).toLowerCase();

            if (text.match(/sport|rugby|gaa|football|hurling|racing|horse|match|team/i)) return 'sport';
            if (text.match(/politics|government|election|party|minister|td|council/i)) return 'politics';
            if (text.match(/business|economy|jobs|company|enterprise/i)) return 'business';
            if (text.match(/culture|arts|music|festival|event|concert/i)) return 'events';

            return 'local';
        }

        // Load articles from Redis
        async function loadArticles() {
            try {
                const response = await fetch('/api/articles/recent?limit=50');
                const data = await response.json();

                // Filter to get only rewritten articles with local angles
                const articles = [];

                // Get all rewritten article IDs
                for (const article of data.articles) {
                    try {
                        const rewrittenResponse = await fetch(`/api/article/rewritten/${article.id}`);
                        if (rewrittenResponse.ok) {
                            const rewritten = await rewrittenResponse.json();
                            if (rewritten.localAngle) {
                                articles.push(rewritten);
                            }
                        }
                    } catch (e) {
                        // Skip if not found
                    }
                }

                if (articles.length === 0) {
                    document.getElementById('loadingMessage').innerHTML = 'üì∞ No articles available. Run <code>npm run weekly</code> to generate content.';
                    return;
                }

                displayArticles(articles);
            } catch (error) {
                console.error('Error loading articles:', error);
                document.getElementById('loadingMessage').innerHTML = '‚ùå Error loading articles. Please refresh the page.';
            }
        }

        function displayArticles(articles) {
            const container = document.getElementById('articlesList');
            const articleCount = document.getElementById('articleCount');

            articleCount.textContent = articles.length;

            articles.forEach((article, index) => {
                // Create article ID for link
                const articleId = article.originalLink
                    .replace(/https?:\/\//, '')
                    .replace(/[^a-z0-9]/gi, '-');

                // Get first paragraph as summary
                const firstParagraph = article.story.split('\n\n')[0];
                const summary = firstParagraph.length > 200
                    ? firstParagraph.substring(0, 200) + '...'
                    : firstParagraph;

                const item = document.createElement('li');
                item.className = 'article-item';
                item.innerHTML = `
                    <div class="article-number">#${index + 1}</div>
                    <h2 class="article-title">
                        <a href="/articles/${articleId}.html">${article.headline}</a>
                    </h2>
                    <p class="article-summary">${summary}</p>
                    <div class="article-meta">
                        ${article.originalSource} ‚Ä¢ ${new Date(article.publishedAt).toLocaleDateString('en-IE')}
                    </div>
                    <a href="/articles/${articleId}.html" class="read-more">Read Full Article ‚Üí</a>
                `;

                container.appendChild(item);
            });

            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('articlesContainer').style.display = 'block';
        }

        // Load articles on page load
        loadArticles();
    </script>
</body>
</html>
